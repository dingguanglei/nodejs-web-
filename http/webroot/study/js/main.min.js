var colorIndex=0;var getArticlesFlag=true;var xhrArticleFlag=true;(function(){Date.prototype.format=function(c){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};if(/(y+)/i.test(c)){c=c.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in b){if(new RegExp("("+a+")").test(c)){c=c.replace(RegExp.$1,RegExp.$1.length===1?b[a]:("00"+b[a]).substr((""+b[a]).length))}}return c}})();document.addEventListener("scroll",function(){var a=document.body.clientHeight-window.scrollY-window.innerHeight;if(xhrArticleFlag&&getArticlesFlag&&a<100){getArticles()}});window.onload=function(){setInterval(changeColor,1000);var h=document.getElementById("icon-menu");h.onclick=menuToggle;classifyBtnInitial();var b=document.getElementsByClassName("btn-writeArticle")[0];b.onclick=showWriteNewArticle;var g=document.getElementById("submiter");g.onclick=submit;var e=document.getElementById("newArticleForm");var f=new Hammer(e);f.on("swiperight",function(a){showWriteNewArticle()});var c=document.getElementsByTagName("a");for(var d=0;d<c.length;d++){c[d].onselectstart=function(){return false}}getArticles()};function getArticles(){xhrArticleFlag=false;var e=new XMLHttpRequest();var c=document.getElementsByClassName("content-box");var a=c.length;var d=document.getElementById("footer-final-label");e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200){var f=JSON.parse(e.responseText);if(e.responseText!=="{}"){while(f[a]){var g=f[a];console.log(g.time);creatContentBox(g.title,g.content,g.type,19-a,g.time);a+=1;d.innerHTML="正在加载更多内容。。。";xhrArticleFlag=true}}else{getArticlesFlag=false;d.innerHTML="没有新内容了！！！"}}}};e.open("post","/getArticles",true);var b=new FormData();b.append("boxLength",a);e.send(b)}function showWriteNewArticle(){var a=document.getElementById("newArticleForm");if(a.style.right==="0px"){a.style.right="-30em"}else{a.style.right="0px"}}function submit(){var b=document.getElementById("newArticleForm");var d=new FormData(b);var a=new Date();a.format("yyyy/MM/dd hh:mm:ss");d.append("time",a.format("yyyy/MM/dd hh:mm:ss"));var c=new XMLHttpRequest();c.onload=function(f){if(c.status==200){var e=c.responseText;console.log(JSON.parse(e));alert("提交成功!!!！");showWriteNewArticle()}else{if(c.status==201){var g=c.responseText;alert(g)}else{console.log("Error"+c.status)}}};c.open("post","/submitArticle");c.send(d);event.preventDefault()}function creatContentBox(m,i,j,o,c){var f=document.getElementById("content-box-wrapper");o="contentLeftImages/"+o+".jpg";var n=document.createElement("img");if(o!=-1){n.setAttribute("data-original",o);n.setAttribute("src","contentLeftImages/loading.gif");n.setAttribute("alt",o);$(function(){$("img").lazyload()});var d=$(n);d.lazyload()}var l=document.createElement("div");l.setAttribute("class","pic-wrapper");l.appendChild(n);var h=document.createElement("h");h.innerHTML=m;h.setAttribute("class","h1");var b=document.createElement("div");b.appendChild(h);b.setAttribute("class","content-header");var e=document.createElement("p");e.innerHTML=i;var g=document.createElement("div");g.setAttribute("class","content-footer");g.innerHTML=c;var a=document.createElement("a");a.setAttribute("class","box box-color-"+j);a.setAttribute("href","");a.appendChild(l);a.appendChild(b);a.appendChild(e);a.appendChild(g);var k=document.createElement("div");k.setAttribute("class","content-box");k.appendChild(a);f.appendChild(k)}function changeColor(){var a=["C10066 ","CC0000","E63F00","EE7700","DDAA00","EEEE00","99DD00","66DD00","00DD00","00DD77","00DDAA","00DDDD","009FCC","0044BB","0000CC","4400CC","5500DD","7700BB","A500CC","CC00CC"];var b=document.getElementById("logo");b.style.color="#"+a[colorIndex];colorIndex=(colorIndex+1)%a.length}function menuToggle(){var b=document.getElementById("icon-menu-list");var a=b.style.height;console.log(a);if(a!=="0px"){b.style.height="0px"}else{b.style.height="236px"}return false}function classifyBtnInitial(){var c=document.getElementsByClassName("content-box");var d=document.getElementById("classify-total");var b=document.getElementById("classify-music");var f=document.getElementById("classify-journal");var e=document.getElementById("classify-study");var a=document.getElementById("classify-process");d.onclick=function(){for(var g=0;g<c.length;g++){c[g].style.opacity=1;active("classify-total")}active("classify-total");return false};e.onclick=function(){showBoxes("box box-color-study");active("classify-study");return false};b.onclick=function(){showBoxes("box box-color-music");active("classify-music");return false};f.onclick=function(){showBoxes("box box-color-journal");active("classify-journal");return false};a.onclick=function(){showBoxes("box box-color-process");active("classify-process");return false}}function showBoxes(a){var e=document.getElementsByClassName("content-box");var d=document.getElementsByClassName(a);for(var b=0;b<e.length;b++){var c=e[b];c.style.opacity=0.2}setTimeout(function(){for(b=0;b<d.length;b++){c=d[b].parentNode;c.style.opacity=1}},300)}function active(c){console.log(c);var e=document.getElementById(c);var b=document.getElementsByClassName("classify-active")[0];console.log(b.className);var a=b.className;b.className=a.replace(" classify-active","");console.log(b.className);var d=e.className;e.className=d+" classiclassify-active"};